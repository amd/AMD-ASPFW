; Copyright(C) 2014-2022 Advanced Micro Devices, Inc. All rights reserved.

    IMPORT LastBytes
    IMPORT ||Image$$SEV_UAPP_CODE$$ZI$$Limit||

;    IMPORT  ||Image$$APP_CODE_RO$$Base||        ; Linker symbol from scatter file

    ;--------------------------------------------------------------------------------------
    ; 256 byte binary header
    ;
    DCB     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00     ; nonce
    DCB     0x24,0x50,0x53,0x31                                                                 ; cookie "$PS1"
    ; Note: we can't use ||Image$$APP_CODE_RO$$Base|| symbol here because of some linker
    ;       limitation (error A1142E: Subtractive relocations not supported for ELF format output).
    ;       If start address in scatter file is changed it should be changed here as well,
    ;       otherwise there will be signature validation error.
    ;
    DCD     LastBytes + 64 - 0x00029000 - 256                                                   ; image size (SizeFwSigned - sizeof(header))
    DCB     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
    DCB     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
    DCB     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
    DCB     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
    DCD     PSP_SEV_UAPP_FW_SPL                                                                 ; [0x4C] Security patch level
    DCB     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00                                             ;
    DCB     0x43,0x01                                                                           ; [0x58] SocFwID 0x0143
    DCB     0x01                                                                                ; [0x5A] Header version 1
    DCB     0x00,0x00,0x00,0x00,0x00
; Why a 1 in the MSB of Image version? Because early SEV UApps had 0.0.1.0... big endian. Or 1.0.0 litte-endian.
; So putting a 1 in the MSB prevents those "old" 0.0.1.0/0.1.0.0 binaries from being downloadable on top of 0.16.x
; Image version is interpreted by Boot Loader C code as a little-endian 32-bit integer
; The LS byte is build #. Then Minor API version. Then Major API version. Then the 0x01.
    DCD     PSP_SEV_UAPP_FW_VERSION                                                             ; [0x60] Image Version
    DCB     0xFF,0xFF,0xFF,0xFF                                                                 ; [0x64] APU Family ID
    DCB     0x00,0x01,0x00,0x00                                                                 ; [0x68] Load Address
    DCB     0x00,0x00,0x00,0x00                                                                 ; [0x6C] In-use in other FWs, shall not use due to compatibility
    DCB     0x00,0x00,0x00,0x00                                                                 ; [0x70] In-use in other FWs, shall not use due to compatibility
    DCD     ||Image$$SEV_UAPP_CODE$$ZI$$Limit|| - EntryPoint                                    ; [0x74] FW Executable size = (RW base - FW entry offset)
    DCB     0x00,0x00,0x00,0x00                                                                 ; [0x78] Reserved
    DCB     0x39                                                                                ; [0x7C] FwTypeLegacy
    DCB     0x00,0x00,0x00
    DCB     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
    DCB     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
    DCB     0x61,0x00,0x29,0x00                                                                 ; [0xA0] Required Bootloader Image Version
    DCB     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00                         ; [0xA4-0xFF]  Reserved
    DCB     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
    DCB     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
    DCB     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
    DCB     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
    DCB     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00

    END
